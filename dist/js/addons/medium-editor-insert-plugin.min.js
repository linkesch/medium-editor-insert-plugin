/*!
 * medium-editor-insert-plugin v0.1.1 - jQuery insert plugin for MediumEditor
 *
 * Addon Initialization
 *
 * https://github.com/orthes/medium-editor-images-plugin
 *
 * Copyright (c) 2013 Pavel Linkesch (http://linkesch.sk)
 * Released under the MIT license
 */
!function(a){var b={};MediumEditor.prototype.serialize=function(){var b,c,d,e,f,g,h,i,j={};for(b=0;b<this.elements.length;b+=1){for(d=""!==this.elements[b].id?this.elements[b].id:"element-"+b,e=a(this.elements[b]).clone(),f=a(".mediumInsert",e),c=0;c<f.length;c++)g=a(f[c]),h=a(".mediumInsert-placeholder",g).children(),0===h.length?g.remove():(g.removeAttr("contenteditable"),a("img[draggable]",g).removeAttr("draggable"),g.hasClass("small")&&h.addClass("small"),a(".mediumInsert-buttons",g).remove(),h.unwrap());i=e.html().trim(),j[d]={value:i}}return j},MediumEditor.prototype.deactivate=function(){var b;if(!this.isActive)return!1;for(this.isActive=!1,void 0!==this.toolbar&&(this.toolbar.style.display="none"),document.documentElement.removeEventListener("mouseup",this.checkSelectionWrapper),b=0;b<this.elements.length;b+=1)this.elements[b].removeEventListener("keyup",this.checkSelectionWrapper),this.elements[b].removeEventListener("blur",this.checkSelectionWrapper),this.elements[b].removeAttribute("contentEditable");a.fn.mediumInsert.insert.$el.mediumInsert("disable")},MediumEditor.prototype.activate=function(){var b;if(this.isActive)return!1;for(void 0!==this.toolbar&&(this.toolbar.style.display="block"),this.isActive=!0,b=0;b<this.elements.length;b+=1)this.elements[b].setAttribute("contentEditable",!0);this.bindSelect(),a.fn.mediumInsert.insert.$el.mediumInsert("enable")},a.fn.mediumInsert=function(c){return"string"==typeof c&&a.fn.mediumInsert.insert[c]?void a.fn.mediumInsert.insert[c]():(a.fn.mediumInsert.settings=a.extend(a.fn.mediumInsert.settings,c),this.each(function(){a("p",this).bind("dragover drop",function(a){return a.preventDefault(),!1}),a.fn.mediumInsert.insert.init(a(this));for(var c in a.fn.mediumInsert.settings.addons){var d=a.fn.mediumInsert.settings.addons[c];d.$el=a.fn.mediumInsert.insert.$el,b[c].init(d)}}))},a.fn.mediumInsert.settings={enabled:!0,addons:{images:{}}},a.fn.mediumInsert.registerAddon=function(a,c){b[a]=c},a.fn.mediumInsert.getAddon=function(a){return b[a]},a.fn.mediumInsert.insert={init:function(a){this.$el=a,this.setPlaceholders(),this.setEvents()},deselect:function(){document.getSelection().removeAllRanges()},disable:function(){a.fn.mediumInsert.settings.enabled=!1,a.fn.mediumInsert.insert.$el.find(".mediumInsert-buttons").addClass("hide")},enable:function(){a.fn.mediumInsert.settings.enabled=!0,a.fn.mediumInsert.insert.$el.find(".mediumInsert-buttons").removeClass("hide")},setPlaceholders:function(){var c=a.fn.mediumInsert.insert.$el,d=a.fn.mediumInsert.settings.editor,e=d&&d.options?d.options.buttonLabels:"",f='<ul class="mediumInsert-buttonsOptions medium-editor-toolbar medium-editor-toolbar-active">';if(0===Object.keys(a.fn.mediumInsert.settings.addons).length)return!1;for(var g in a.fn.mediumInsert.settings.addons)f+="<li>"+b[g].insertButton(e)+"</li>";f+="</ul>",f='<div class="mediumInsert" contenteditable="false"><div class="mediumInsert-buttons"><div class="mediumInsert-buttonsIcon">&rarr;</div><a class="mediumInsert-buttonsShow">+</a>'+f+'</div><div class="mediumInsert-placeholder"></div></div>',c.is(":empty")&&c.html("<p><br></p>"),c.keyup(function(){var b=0,d=c.children(":last");d.hasClass("mediumInsert")&&d.find(".mediumInsert-placeholder").children().length>0&&c.append("<p><br></p>"),c.children("p").each(function(){a(this).next().hasClass("mediumInsert")===!1&&(a(this).after(f),a(this).next(".mediumInsert").attr("id","mediumInsert-"+b)),b++})}).keyup()},setEvents:function(){var c=this,d=a.fn.mediumInsert.insert.$el;d.on("selectstart",".mediumInsert",function(a){return a.preventDefault(),!1}),d.on("blur",function(){var b,c=a(this).clone();c.find(".mediumInsert").remove(),b=c.html().replace(/^\s+|\s+$/g,""),(""===b||"<p><br></p>"===b)&&a(this).addClass("medium-editor-placeholder")}),d.on("click",".mediumInsert-buttons a.mediumInsert-buttonsShow",function(){var b=a(this).siblings(".mediumInsert-buttonsOptions"),d=a(this).parent().siblings(".mediumInsert-placeholder");a(this).hasClass("active")?(a(this).removeClass("active"),b.hide(),a("a",b).show()):(a(this).addClass("active"),b.show(),a("a",b).each(function(){var c=a(this).attr("class").split("action-")[1],e=c.split("-")[0];a(".mediumInsert-"+e,d).length>0&&a("a:not(.action-"+c+")",b).hide()})),c.deselect()}),d.on("mouseleave",".mediumInsert",function(){a("a.mediumInsert-buttonsShow",this).removeClass("active"),a(".mediumInsert-buttonsOptions",this).hide()}),d.on("click",".mediumInsert-buttons .mediumInsert-action",function(){var c=a(this).data("addon"),d=a(this).data("action"),e=a(this).parents(".mediumInsert-buttons").siblings(".mediumInsert-placeholder");b[c]&&b[c][d]&&b[c][d](e),a(this).parents(".mediumInsert").mouseleave()})}}}(jQuery);