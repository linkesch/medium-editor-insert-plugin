/*! 
 * medium-editor-insert-plugin v0.3.2 - jQuery insert plugin for MediumEditor
 *
 * https://github.com/orthes/medium-editor-insert-plugin
 * 
 * Copyright (c) 2014 Pavel Linkesch (http://linkesch.sk)
 * Released under the MIT license
 */

!function(a){a.fn.mediumInsert.registerAddon("tables",{defaults:{defaultRows:2,defaultCols:2},init:function(b){this.options=a.extend(this.defaults,b),this.$el=a.fn.mediumInsert.insert.$el,this.setTableButtonEvents()},insertButton:function(a){var b="Table";return("fontawesome"===a||"object"==typeof a&&a.fontawesome)&&(b='<i class="fa fa-table"></i>'),"object"==typeof a&&a.table&&(b=a.table),'<button data-addon="tables" data-action="add" class="medium-editor-action mediumInsert-action">'+b+"</button>"},add:function(b){a.fn.mediumInsert.insert.deselect();var c='<div class="medium-editor-toolbar-form-anchor mediumInsert-tableDemoBox"><table><tr><td></td><td><label>cols:<input type="text" value="'+this.options.defaultCols+'" class="mediumInsert-tableCols" /></label></td></tr><tr><td><label>rows:<input type="text" value="'+this.options.defaultRows+'" class="mediumInsert-tableRows" /></label></td><td><table class="mediumInsert-demoTable"></table></td></tr><tr><td></td><td><label><button class="mediumInsert-tableReadyButton">insert</button></label></td></tr></table></</div>';a(c).appendTo(b.prev()),this.updateDemoTable(),setTimeout(function(){b.prev().find("input").focus()},50),a.fn.mediumInsert.insert.deselect(),this.currentPlaceholder=b},setTableButtonEvents:function(){var b=this;a(document).on("keyup","input.mediumInsert-tableRows, input.mediumInsert-tableCols",function(){b.updateDemoTable()}),a(document).on("click",function(c){0===a(c.target).parents(".mediumInsert-buttons").length&&b.removeToolbar()}),a(document).on("click","button.mediumInsert-tableReadyButton",function(){b.setEnterActionEvents(),b.removeToolbar()})},getDimensions:function(){return{rows:parseFloat(a("input.mediumInsert-tableRows").val())||1,cols:parseFloat(a("input.mediumInsert-tableCols").val())||1}},buildTable:function(b){var c,d,e,f=this.getDimensions(),g=a(b);for(c=0;c<f.rows;c++){for(e=a("<tr>"),d=0;d<f.cols;d++)e.append("<td>");g.append(e)}},updateDemoTable:function(){var b=a("table.mediumInsert-demoTable");b.empty(),this.buildTable(b)},setEnterActionEvents:function(){var b=this;if(a.fn.mediumInsert.settings.enabled===!1)return!1;var c=a('<table class="mediumInsert-table">');b.buildTable(c),b.currentPlaceholder.append(c),b.currentPlaceholder.closest("[data-medium-element]").trigger("keyup").trigger("input")},removeToolbar:function(){a(".mediumInsert-tableDemoBox").remove()}})}(jQuery);